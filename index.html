<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Arbeitszeit Rechner — AXA Style</title>
<style>
  :root{
    --axa-blue:#005ea6;
    --axa-red:#e60028;
    --axa-bg:#f6f9fc;
    --card:#ffffff;
    --text:#0b0b0b;
    --muted:rgba(11,11,11,0.6);
    --success:#2a9d8f;
    --danger:#e63946;
    --glass: rgba(255,255,255,0.6);
    --font-sans: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }

/* Dark theme variables (etwas heller, Copilot-ähnlich) */
html[data-theme="dark"]{
  --axa-bg: #0b2b3b;      /* dunkles, aber weniger tiefes Blau */
  --card:   #122433;      /* Card-Hintergrund etwas aufgehellt */
  --text:   #e8f3fb;      /* sehr helles, aber nicht reines Weiß */
  --muted:  rgba(232,243,251,0.78); /* abgeschwächte Sekundärfarbe */
  --glass:  rgba(255,255,255,0.04);  /* dezente Glas-Note */
}

  *{box-sizing:border-box;font-family:var(--font-sans);}
  html,body{height:100%}
  body{
    margin:0;
    background:var(--axa-bg);
    color:var(--text);
    display:flex;
    align-items:center;
    justify-content:center;
    padding:28px;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
  }

  /* AXA-like patterned background (less bright; respects dark mode) */
  body::before{
    content: "";
    position: fixed;
    inset: 0;
    background-color: #bcdff0; /* dezentes, dunkleres Hellblau */
    background-image:
      linear-gradient(135deg, rgba(0,94,166,0.035) 25%, transparent 25%) -10px 0/40px 40px,
      linear-gradient(225deg, rgba(230,0,40,0.012) 25%, transparent 25%) -10px 0/40px 40px,
      linear-gradient(45deg, rgba(0,94,166,0.02) 25%, transparent 25%) 0 0/40px 40px,
      linear-gradient(315deg, rgba(230,0,40,0.006) 25%, transparent 25%) 0 0/40px 40px;
    pointer-events: none;
    z-index: 0;
    mix-blend-mode: normal;
    opacity: 0.92;
  }

  /* Dark mode: dim the pattern so cards remain clear */
  html[data-theme="dark"] body::before{
    background-color: rgba(3,18,30,0.48);
    background-image:
      linear-gradient(135deg, rgba(0,94,166,0.02) 25%, transparent 25%) -10px 0/40px 40px;
    mix-blend-mode: overlay;
    opacity: 0.6;
  }

  .container{
    position:relative;
    z-index:1;
    width:100%;
    max-width:820px;
    background:linear-gradient(180deg,var(--glass),transparent);
    border-radius:12px;
    padding:22px;
    box-shadow: 0 10px 30px rgba(2,6,23,0.12);
    backdrop-filter: blur(6px);
    border:1px solid rgba(11,11,11,0.04);
  }

  header{display:flex;align-items:center;gap:16px;margin-bottom:8px}
  /* Logo container: kein weißer Hintergrund, kein Padding, kein Rahmen */
  .logo{
    width:64px;height:64px;border-radius:8px;
    display:flex;align-items:center;justify-content:center;overflow:hidden;
    background:transparent;border:none;padding:0;margin:0;
  }
  /* Bild: transparent background erwartet; falls PNG hat weißen Rand, ersetze Datei durch transparente Version */
  .logo img{
    display:block;
    width:86%;
    height:auto;
    background:transparent;
    margin:0;
    padding:0;
    border:0;
    image-rendering:auto;
    /* Falls das PNG einen weißen Kasten hat und du trotzdem eine Variante ohne weißen Kasten willst,
       entferne die folgende line (sie ist ein best-effort, kann nicht echte weiße Pixel löschen) */
    mix-blend-mode: normal;
  }

  .brand h1{margin:0;font-size:18px;color:var(--axa-blue);font-weight:800}
  .brand p{margin:0;font-size:13px;color:var(--muted)}

  .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-top:12px}
  @media(max-width:720px){.grid{grid-template-columns:1fr}}

  label{font-size:13px;color:var(--muted);display:block;margin-bottom:6px}
  input[type="time"], input[type="number"]{
    width:100%;padding:10px;border-radius:10px;border:1px solid rgba(11,11,11,0.06);
    background:var(--card);color:var(--text);font-size:14px;
    box-shadow: 0 4px 14px rgba(2,6,23,0.06);
  }

  .tile{
    background:var(--card);
    padding:12px;border-radius:10px;border:1px solid rgba(11,11,11,0.04);
    box-shadow: 0 6px 18px rgba(2,6,23,0.06);
  }
  html[data-theme="dark"] .tile{
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border:1px solid rgba(255,255,255,0.04);
    box-shadow: 0 8px 24px rgba(2,6,23,0.45);
  }

  .controls{display:flex;gap:12px;align-items:center;margin-top:16px;flex-wrap:wrap}
  .left-controls{display:flex;gap:12px;align-items:center}
  .small-input{min-width:160px}
  button{background:var(--axa-blue);color:#fff;padding:10px 14px;border-radius:10px;border:0;cursor:pointer;font-weight:700}
  .secondary{background:transparent;border:1px solid rgba(11,11,11,0.08);color:var(--text);padding:10px 12px;border-radius:10px}

  .result{margin-top:18px;padding:14px;border-radius:10px;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);display:flex;justify-content:space-between;align-items:center}
  .big{font-size:20px;font-weight:800;color:var(--text)}
  .small{font-size:13px;color:var(--muted)}

  .diff-positive{color:var(--success);font-weight:800}
  .diff-negative{color:var(--danger);font-weight:800}

  footer{margin-top:14px;font-size:12px;color:var(--muted)}

  /* Slider toggle for dark mode */
  .toggle {
    --w:48px; --h:28px; --pad:3px;
    width:var(--w); height:var(--h); border-radius:999px; position:relative;
    background:linear-gradient(180deg,#e6eef8,#dbeefc); border:1px solid rgba(11,11,11,0.06);
    display:inline-block; cursor:pointer; transition:all .22s ease;
  }
  html[data-theme="dark"] .toggle{ background: linear-gradient(180deg,#0b2a45,#062033); border:1px solid rgba(255,255,255,0.06); }
  .toggle .knob{
    position:absolute; top:var(--pad); left:var(--pad); width:calc(var(--h) - var(--pad)*2); height:calc(var(--h) - var(--pad)*2);
    background:#fff;border-radius:50%;box-shadow:0 6px 14px rgba(2,6,23,0.12); transition:all .22s ease;
  }
  html[data-theme="dark"] .toggle .knob{ left: calc(var(--w) - var(--h) + var(--pad)); background:linear-gradient(180deg,#e6eef8,#cfe8ff); box-shadow:0 8px 20px rgba(2,6,23,0.45); }

  .settings{margin-left:auto;display:flex;gap:12px;align-items:center}
  .muted{color:var(--muted)}

  /* -------------------------
     Time input icon handling
     - Default (light): no custom background-image, native picker visible (one icon)
     - Dark: WebKit -> invert native indicator (one icon)
             Firefox -> remove native UI and show one white SVG background icon
     ------------------------- */

  /* Default: ensure no custom background image so native icon shows once in light mode */
  input[type="time"] {
    -moz-appearance: textfield;
    appearance: none;
    background-image: none;
    padding-right: 12px;
  }

  /* WebKit browsers in Dark Mode: invert native picker icon (keeps single icon) */
  html[data-theme="dark"] input[type="time"]::-webkit-calendar-picker-indicator {
    filter: invert(1) brightness(1.6);
    opacity: 1;
  }

  /* Firefox: use feature detection to apply a single SVG icon in dark mode (native picker not stylable) */
  @supports (-moz-appearance: none) {
    html[data-theme="dark"] input[type="time"] {
      -moz-appearance: textfield;
      appearance: none;
      padding-right: 40px; /* Platz für das SVG-Icon */
      background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24' fill='none'><circle cx='12' cy='12' r='9' stroke='%23ffffff' stroke-width='1.6'/><path d='M12 7v6l4 2' stroke='%23ffffff' stroke-width='1.6' stroke-linecap='round' stroke-linejoin='round'/></svg>");
      background-repeat: no-repeat;
      background-position: right 10px center;
      background-size: 20px 20px;
      background-color: rgba(255,255,255,0.03);
      color: #e6eef8;
    }
    html[data-theme="dark"] input[type="time"]::-ms-clear,
    html[data-theme="dark"] input[type="time"]::-ms-expand { display: none; }
  }

  /* Ensure light mode doesn't invert native indicator */
  html[data-theme="light"] input[type="time"]::-webkit-calendar-picker-indicator {
    filter: none;
  }

  /* Force consistent text colors so "der Text hat sich verändert" nicht mehr passiert */
  body, input, button, label, select, textarea {
    color: var(--text);
    font-family: var(--font-sans);
  }
  html[data-theme="dark"] body, html[data-theme="dark"] input, html[data-theme="dark"] button, html[data-theme="dark"] label {
    color: var(--text);
  }

</style>
</head>
<body>
  <div class="container" id="app" role="application" aria-label="Arbeitszeit Rechner">
    <header>
      <div class="logo" aria-hidden="true">
        <!-- Wenn du berechtigt bist: lege axa-logo.png in denselben Ordner -->
        <img src="axa-logo.png" alt="AXA Logo" onerror="this.style.display='none'">
      </div>

      <div class="brand">
        <h1>Arbeitszeit Rechner</h1>
        <p class="muted">lokal ausführbar</p>
      </div>

      <div class="settings" aria-hidden="false">
        <div style="text-align:right">
          <div class="muted" style="font-size:12px">Theme</div>
          <div id="themeToggle" class="toggle" role="button" aria-pressed="false" tabindex="0" title="Dark / Light">
            <div class="knob"></div>
          </div>
        </div>
      </div>
    </header>

    <main>
      <div class="grid">
        <div class="tile">
          <label for="start">Anfang</label>
          <input id="start" type="time" />
        </div>

        <div class="tile">
          <label for="end">Ende</label>
          <input id="end" type="time" />
        </div>

        <div class="tile">
          <label for="pauseStart">Pause Anfang</label>
          <input id="pauseStart" type="time" value="12:00" />
        </div>

        <div class="tile">
          <label for="pauseEnd">Pause Ende</label>
          <input id="pauseEnd" type="time" value="12:30" />
        </div>
      </div>

      <div class="controls">
        <div class="left-controls">
          <div class="tile small-input">
            <label for="target">Soll Zeit Stunden</label>
            <input id="target" type="number" step="0.1" min="0" value="7.6" />
          </div>
        </div>

        <div style="margin-left:auto;display:flex;gap:8px;align-items:center">
          <button id="calc">Calculate</button>
          <button id="reset" class="secondary">Reset</button>
        </div>
      </div>

      <div class="result" id="result" aria-live="polite" style="display:none">
        <div>
          <div class="big" id="worked">0.00 h</div>
          <div class="small" id="breakInfo">Pause 0.00 h</div>
        </div>
        <div style="text-align:right">
          <div class="small">Soll</div>
          <div id="targetDisplay" class="big">7.6 h</div>
          <div id="diff" class="small">Δ 0.00 h</div>
        </div>
      </div>

      <footer>
        <div class="muted">Hinweis: bei einer Arbeitszeit von +9H wird automtisch eine pause von 45m abgezogen <strong>axa-logo.png</strong> in dasselbe Verzeichnis.</div>
      </footer>
    </main>
  </div>

<script>
  // Helferfunktionen
  function timeToMinutes(t){ if(!t) return null; const [h,m]=t.split(':').map(Number); return h*60+m; }
  function minutesToHours(min){ return Math.round((min/60)*100)/100; }

  // DOM
  const startEl = document.getElementById('start');
  const endEl = document.getElementById('end');
  const pStartEl = document.getElementById('pauseStart');
  const pEndEl = document.getElementById('pauseEnd');
  const targetEl = document.getElementById('target');
  const calcBtn = document.getElementById('calc');
  const resetBtn = document.getElementById('reset');
  const resultBox = document.getElementById('result');
  const workedEl = document.getElementById('worked');
  const breakInfoEl = document.getElementById('breakInfo');
  const diffEl = document.getElementById('diff');
  const targetDisplay = document.getElementById('targetDisplay');

  // Theme toggle element (custom slider)
  const themeToggle = document.getElementById('themeToggle');

  // Load settings (Dark mode default if nothing saved)
  function loadSettings(){
    const savedTheme = localStorage.getItem('aw_theme');
    const theme = savedTheme ? savedTheme : 'dark';
    document.documentElement.setAttribute('data-theme', theme === 'dark' ? 'dark' : 'light');
    themeToggle.setAttribute('aria-pressed', theme === 'dark' ? 'true' : 'false');
    if(!savedTheme) localStorage.setItem('aw_theme', 'dark');

    const savedTarget = localStorage.getItem('aw_target');
    if(savedTarget) targetEl.value = savedTarget;
    targetDisplay.textContent = targetEl.value + ' h';
  }
  loadSettings();

  // Toggle theme (click or keyboard)
  function setTheme(theme){
    document.documentElement.setAttribute('data-theme', theme);
    localStorage.setItem('aw_theme', theme);
    themeToggle.setAttribute('aria-pressed', theme === 'dark' ? 'true' : 'false');
  }
  themeToggle.addEventListener('click', ()=>{
    const cur = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'light';
    setTheme(cur === 'dark' ? 'light' : 'dark');
  });
  themeToggle.addEventListener('keydown', (e)=>{
    if(e.key === 'Enter' || e.key === ' ') { e.preventDefault(); themeToggle.click(); }
  });

  // Calculation logic with overlap handling
  function calculate(){
    const s = timeToMinutes(startEl.value);
    const e = timeToMinutes(endEl.value);
    const ps = timeToMinutes(pStartEl.value);
    const pe = timeToMinutes(pEndEl.value);
    const target = parseFloat(targetEl.value) || 0;

    if(s===null || e===null || ps===null || pe===null){
      alert('Bitte alle Zeitfelder ausfüllen.');
      return;
    }

    // total work minutes (support next day)
    let totalWorkMin = e - s;
    if(totalWorkMin <= 0) totalWorkMin += 24*60;

    // pause minutes (support next day)
    let pauseMin = pe - ps;
    if(pauseMin < 0) pauseMin += 24*60;

    // overlap between work interval and pause interval
    function normIntervals(start, length){
      const end = start + length;
      if(end <= 24*60) return [[start,end]];
      return [[start,24*60],[0,end - 24*60]];
    }
    function overlap(aStart,aLen,bStart,bLen){
      const A = normIntervals(aStart,aLen);
      const B = normIntervals(bStart,bLen);
      let ov = 0;
      for(const [as,ae] of A) for(const [bs,be] of B){
        const lo = Math.max(as,bs);
        const hi = Math.min(ae,be);
        if(hi>lo) ov += hi-lo;
      }
      return ov;
    }

    const effectivePause = overlap(s, totalWorkMin, ps, pauseMin);
    const netMin = Math.max(0, totalWorkMin - effectivePause);
    const netHours = minutesToHours(netMin);
    const pauseHours = minutesToHours(effectivePause);
    const diff = Math.round((netHours - target)*100)/100;

    // Update UI
    workedEl.textContent = netHours.toFixed(2) + ' h';
    breakInfoEl.textContent = 'Pause ' + pauseHours.toFixed(2) + ' h';
    targetDisplay.textContent = target + ' h';
    diffEl.textContent = (diff >= 0 ? 'Δ +' : 'Δ ') + diff.toFixed(2) + ' h';
    diffEl.className = diff >= 0 ? 'diff-positive' : 'diff-negative';
    resultBox.style.display = 'flex';

    // Save target
    localStorage.setItem('aw_target', target.toString());
  }

  calcBtn.addEventListener('click', calculate);

  // Reset
  resetBtn.addEventListener('click', ()=>{
    startEl.value = '';
    endEl.value = '';
    pStartEl.value = '12:00';
    pEndEl.value = '12:30';
    resultBox.style.display = 'none';
  });

  // Live update target display
  targetEl.addEventListener('input', ()=> targetDisplay.textContent = (targetEl.value || '0') + ' h');

  // Ensure default pause values
  if(!pStartEl.value) pStartEl.value = '12:00';
  if(!pEndEl.value) pEndEl.value = '12:30';
</script>
</body>
</html>
